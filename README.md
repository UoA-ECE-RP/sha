# Branch JsonToIEC
Generate IEC-61499 function block from Json file generated by the HA design tool

## This is the procedure to run the code for the watertank example:

#!/bin/bash 
``` bash
cd ./language
export PYTHONPATH=`pwd`
python shac.py ../examples/hajson/waterTankJason.json fbt PATH(this is the path where the .fbt file will be saved. E.g. C:\\vsplugin\\sha-compiler\\compiler\\cj\\)
```

## Installing dependencies 
``` bash
pip install sympy macropy colorama termcolor lxml
```


Below is more general process to use the compiler:
1. Compile single module
To compile a single HA model, you can use bash file compileJson.sh. It is needed to be modified before executing by following the instruction.
The example file is as below:
#!/bin/bash 

cd ./language
export PYTHONPATH=`pwd`

#on windows
#the first path is where the json file, and the second path is where you want to save the #converted .fbt file
#python shac.py ../examples/hajson/waterTank.json fbt C:\\vsplugin\\sha\\generatedHA\\

#on linux or mac
#the first path is where the json file, and the second path is where you want to save the #converted .fbt file
python shac.py ../examples/hajson/waterTank.json fbt /Users/jinchen/Desktop/2016_Semester1/VS\ plugin/JsonToIEC/generatedHA/
python shac.py ../examples/hajson/gasBurner.json fbt /Users/jinchen/Desktop/2016_Semester1/VS\ plugin/JsonToIEC/generatedHA/

You can run it by executing below command under JsonToIEC folder:
jinchen$ sudo ./compileJson.sh

It will generate a YourModelName.fbt file under the assigned folder.

2. Compile multiple modules combined system
To compile a multiple modules combined system (I.e. the JSON file you generated by connecting multiple interfaces), you can execute compileJsonToCFB bash file. It is needed to be modified before executing by following the instruction.

#!/bin/bash 

cd ./language
export PYTHONPATH=`pwd`

#the json file should be put in the language folder for now, and the last parameter is the path #you want to save the generated .cfb file
python shac.py gasBurner_waterTank_Interface.json cfb /Users/jinchen/Desktop/2016_Semester1/VS\ plugin/JsonToIEC/generatedHA/

Note: you need to put all JSON files of the single models composing this composite system under /examples/hajson/ folder before you execute the bash, otherwise the compiler will can’t find the files.

You can run the bash file  by executing below command under JsonToIEC folder:
jinchen$ sudo ./compileJson.sh

It will generate a cjtest.cfb file under the assigned folder.


3. Import .fbt and .cfb files into BlokIDE
3.1 Import .fbt file into BlokIDE
The .fbt file can be imported directly to BlokIDE by using “Import IEC61499 files” function. Note: you can only select folder rather than files to import, so you need to put all .fbt files into a folder, then choose that folder when importing.

3.2 Import .cfb file into BlokIDE
Before you import a .cfb file, you need to import all single models composing this composite system into BlokIDE first.
For now, BlokIDE doesn’t support .cfb file importing. Fortunately, we have a work around to do this. Firstly, open an existing BlokIDE project. Then add a new Composite function block by right click the name of the project in visual studio. After that, you should have a new file named CompositeFunctionBlock1.cfb under your project folder. So you can copy the json converted .cfb file to the same folder, and replace the existing CompositeFunctionBlock1.cfb by it. At last, you can open the CompositeFunctionBlock1.cfb in BlokIDE now.

